;;                      Realer Programmer's Dvorak
;;
;; KMonad variation of Real Programmer Dvorak with home row mods and such.
;; Based on Michael Paulson's poor ideas.
;;
;; Template for a new layer:
;;
;; (deflayer name
;;   _    _    _    _    _    _    _    _    _    _    _    _    _    _    _    _    _
;;   _    _    _    _    _    _    _    _    _    _    _    _    _         _
;;   _    _    _    _    _    _    _    _    _    _    _    _    _         _
;;   _    _    _    _    _    _    _    _    _    _    _    _              _
;;   _    _    _    _    _    _    _    _    _    _    _                   _
;;   _    _    _    _         _              _    _    _         _    _    _
;;                                                               _    _    _
;; )
;;
;; Template for a QWERTY layer:
;;
;; (deflayer name
;;   esc  f1   f2   f3   f4   f5   f6   f7   f8   f9   f10  f11  f12  home end  ins  del
;;   `    1    2    3    4    5    6    7    8    9    0    -    =         bspc
;;   tab  q    w    e    r    t    y    u    i    o    p    [    ]         bksl
;;   caps a    s    d    f    g    h    j    k    l    ;    '              ret
;;   lsft z    x    c    v    b    n    m    ,    .    /                   rsft
;;   fn   lctl lmet lalt      spc            ralt ssrq rctl      pgup up   pgdn
;;                                                               left down rght
;; )
;;
;; Template for a Dvorak layer:
;;
;; (deflayer name
;;   esc  f1   f2   f3   f4   f5   f6   f7   f8   f9   f10  f11  f12  home end  ins  del
;;   $    +    [    {    \(   &    =    \)   }    ]    *    !    |         bspc
;;   tab  ;    ,    .    p    y    f    g    c    r    l    /    @         \
;;   caps a    o    e    u    i    d    h    t    n    s    -              ret
;;   @lsl '    q    j    k    x    b    m    w    v    z                   @rsl
;;   fn   lctl lmet lalt      spc            ralt @prt rctl     pgup up   pgdn
;;                                                               left down rght
;; )

(defcfg
  input (device-file "/dev/input/by-path/platform-i8042-serio-0-event-kbd")
  output (uinput-sink "Kmonad: Thinkpad"))

;;; Aliases

;; In order to enable dense layout, rename everything >4 chars so I can do 5
;; char columns.

;; Layer aliases
(defalias
  lsl (around (layer-toggle rpdv-lsft) lsft)
  rsl (around (layer-toggle rpdv-rsft) rsft)
  dvk (layer-switch rpdv)
  qwt (layer-switch qwerty)
  mvt (layer-toggle mvmt)
  lnl (layer-toggle lnum)
  rnl (layer-toggle rnum))

;; Functions
(defalias
  amv (tap-hold-next-release 1000 a @mvt :timeout-button a)
  ,nm (tap-hold-next-release 1000 , @lnl :timeout-button ,)
  oal (tap-hold-next-release 1000 o lalt :timeout-button o)
  .mt (tap-hold-next-release 1000 . lmet :timeout-button .)
  ect (tap-hold-next-release 1000 e lctl :timeout-button e)
  usf (tap-hold-next-release 1000 u @lsl :timeout-button u)
  hsf (tap-hold-next-release 1000 h @rsl :timeout-button h)
  tct (tap-hold-next-release 1000 t rctl :timeout-button t)
  cmt (tap-hold-next-release 1000 c rmet :timeout-button c)
  nal (tap-hold-next-release 1000 n ralt :timeout-button n)
  rnm (tap-hold-next-release 1000 r @rnl :timeout-button r))

;; Shifted Dvorak keys
(defalias
  ls0 (tap-macro-release lsft 0 lsft)
  rs0 (tap-macro-release rsft 0 rsft)
  ls1 (tap-macro-release lsft 1 lsft)
  rs1 (tap-macro-release rsft 1 rsft)
  ls2 (tap-macro-release lsft 2 lsft)
  rs2 (tap-macro-release rsft 2 rsft)
  ls3 (tap-macro-release lsft 3 lsft)
  rs3 (tap-macro-release rsft 3 rsft)
  ls4 (tap-macro-release lsft 4 lsft)
  rs4 (tap-macro-release rsft 4 rsft)
  ls5 (tap-macro-release lsft 5 lsft)
  rs5 (tap-macro-release rsft 5 rsft)
  ls6 (tap-macro-release lsft 6 lsft)
  rs6 (tap-macro-release rsft 6 rsft)
  ls7 (tap-macro-release lsft 7 lsft)
  rs7 (tap-macro-release rsft 7 rsft)
  ls8 (tap-macro-release lsft 8 lsft)
  rs8 (tap-macro-release rsft 8 rsft)
  ls9 (tap-macro-release lsft 9 lsft)
  rs9 (tap-macro-release rsft 9 rsft)
  ls` (tap-macro-release lsft ` lsft)
  rs` (tap-macro-release rsft ` rsft)
)

;; Misc
(defalias
  prt sysrq)

;;; Layers

;; Source layer - used to set the default keys to be overwritten later. Not an
;; actual layer in the layout.

(defsrc
  esc  f1   f2   f3   f4   f5   f6   f7   f8   f9   f10  f11  f12  home end  ins  del
  `    1    2    3    4    5    6    7    8    9    0    -    =         bspc
  tab  q    w    e    r    t    y    u    i    o    p    [    ]         bksl
  caps a    s    d    f    g    h    j    k    l    ;    '              ret
  lsft z    x    c    v    b    n    m    ,    .    /                   rsft
  fn   lctl lmet lalt      spc            ralt ssrq rctl      pgup up   pgdn
                                                              left down rght
)

(deflayer rpdv
  esc  f1   f2   f3   f4   f5   f6   f7   f8   f9   f10  f11  f12  home end  ins  del
  $    +    [    {    \(   &    =    \)   }    ]    *    !    |         bspc
  tab  ;    @,nm @.mt p    y    f    g    @cmt @rnm l    /    @         \
  lctl @amv @oal @ect @usf i    d    @hsf @tct @nal s    -              ret
  @lsl '    q    j    k    x    b    m    w    v    z                   @rsl
  fn   lmet lalt f13       spc            bspc @prt @qwt      pgup up   pgdn
                                                              left down rght
)

(deflayer rpdv-lsft
  _    _    _    _    _    _    _    _    _    _    _    _    _    _    _    _    _
  ~    @ls1 @ls2 @ls3 @ls4 @ls5 @ls6 @ls7 @ls8 @ls9 @ls0 %    @ls`      _
  _    :    <    >    P    Y    F    G    C    R    L    ?    ^         #
  _    A    O    E    U    I    D    H    T    N    S    \_             _
  caps "    Q    J    K    X    B    M    W    V    Z                   caps
  _    _    _    _         _              _    _    _         _    _    _
                                                              _    _    _
)

(deflayer rpdv-rsft
  _    _    _    _    _    _    _    _    _    _    _    _    _    _    _    _    _
  ~    @rs1 @rs2 @rs3 @rs4 @rs5 @rs6 @rs7 @rs8 @rs9 @rs0 %    @rs`      _
  _    :    <    >    P    Y    F    G    C    R    L    ?    ^         #
  _    A    O    E    U    I    D    H    T    N    S    \_             _
  caps "    Q    J    K    X    B    M    W    V    Z                   caps
  _    _    _    _         _              _    _    _         _    _    _
                                                              _    _    _
)

(deflayer mvmt
  _    _    _    _    _    _    _    _    _    _    _    _    _    _    _    _    _
  _    _    _    _    _    _    _    _    _    _    _    _    _         _
  _    _    _    _    _    _    _    pgup up   pgdn _    _    _         _
  _    _    _    lctl lsft _    _    left down rght ret  _              _
  _    _    _    _    _    _    esc  _    _    _    _                   _
  _    _    _    _         _              _    _    _         _    _    _
                                                              _    _    _
)

(deflayer lnum
  _    _    _    _    _    _    _    _    _    _    _    _    _    _    _    _    _
  _    _    _    _    _    _    _    _    _    _    _    _    _         _
  _    0    1    2    3    4    _    _    _    _    _    _    _         _
  _    5    6    7    8    9    _    _    _    _    _    _              _
  _    _    _    _    _    _    _    _    _    _    _                   _
  _    _    _    _         _              _    _    _         _    _    _
                                                              _    _    _
)

(deflayer rnum
  _    _    _    _    _    _    _    _    _    _    _    _    _    _    _    _    _
  _    _    _    _    _    _    _    _    _    _    _    _    _         _
  _    _    _    _    _    _    _    0    1    2    3    4    _         _
  _    _    _    _    _    _    _    5    6    7    8    9              _
  _    _    _    _    _    _    _    _    _    _    _                   _
  _    _    _    _         _              _    _    _         _    _    _
                                                              _    _    _
)

(deflayer qwerty
  esc  f1   f2   f3   f4   f5   f6   f7   f8   f9   f10  f11  f12  home end  ins  del
  `    1    2    3    4    5    6    7    8    9    0    -    =         bspc
  tab  q    w    e    r    t    y    u    i    o    p    [    ]         bksl
  caps a    s    d    f    g    h    j    k    l    ;    '              ret
  lsft z    x    c    v    b    n    m    ,    .    /                   rsft
  fn   lctl lmet lalt      spc            ralt @prt @dvk      pgup up   pgdn
                                                              left down rght
)

;; vim: tabstop=2 shiftwidth=2
